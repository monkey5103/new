<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>後台管理 - 藥品資料</title>
  <style>
    body { font-family: sans-serif; max-width: 900px; margin: auto; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    input[type=text], input[type=number] { width: 100%; }
    button { padding: 6px 12px; margin: 2px; }
  </style>
</head>
<body>

<script>
  if (sessionStorage.getItem("adminLoggedIn") !== "true") {
    alert("請先登入");
    window.location.href = "login.html";
  }
</script>

  <h2>🛠 後台管理：藥品資料</h2>

  <table>
    <thead>
      <tr>
        <th>代碼</th>
        <th>品名</th>
        <th>規格</th>
        <th>單價</th>
        <th>狀態</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="productTable"></tbody>
  </table>

  <h3>新增藥品</h3>
  <form id="addForm">
    <input type="text" placeholder="代碼" id="code" required>
    <input type="text" placeholder="品名" id="name" required>
    <input type="text" placeholder="規格" id="spec" required>
    <input type="number" placeholder="單價" id="price" required>
    <input type="text" placeholder="供應狀態" id="status" value="供貨中" required>
    <button type="submit">新增</button>
  </form>

  <script>
    function loadProducts() {
      const data = localStorage.getItem("products");
      return data ? JSON.parse(data) : [];
    }

    function saveProducts(data) {
      localStorage.setItem("products", JSON.stringify(data));
    }

    let products = loadProducts();
    const table = document.getElementById("productTable");

    function renderTable() {
      table.innerHTML = "";
      products.forEach((p, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input value="${p.code}" onchange="update(${i}, 'code', this.value)"></td>
          <td><input value="${p.name}" onchange="update(${i}, 'name', this.value)"></td>
          <td><input value="${p.spec}" onchange="update(${i}, 'spec', this.value)"></td>
          <td><input type="number" value="${p.price}" onchange="update(${i}, 'price', this.value)"></td>
          <td><input value="${p.status}" onchange="update(${i}, 'status', this.value)"></td>
          <td><button onclick="remove(${i})">刪除</button></td>
        `;
        table.appendChild(row);
      });
    }

    function update(index, field, value) {
      products[index][field] = field === "price" ? Number(value) : value;
      saveProducts(products);
    }

    function remove(index) {
      if (confirm("確定要刪除這筆資料嗎？")) {
        products.splice(index, 1);
        saveProducts(products);
        renderTable();
      }
    }

    document.getElementById("addForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const newItem = {
        code: document.getElementById("code").value,
        name: document.getElementById("name").value,
        spec: document.getElementById("spec").value,
        price: Number(document.getElementById("price").value),
        status: document.getElementById("status").value
      };
      products.push(newItem);
      saveProducts(products);
      renderTable();
      this.reset();
    });

    renderTable();
  </script>

</body>
</html>
